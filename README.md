# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Для данных, которые приходят с сервера

```
export interface ApiResponse {
    total: number;
    items: IProduct[],
}
```

Товар
```
export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: ProductType;
    price: number;
}
```

Форма с данными пользователя
```
export interface IUserForm {
    payment: PaymentMethod;
    address: string;
    email: string;
    phone: string;
}
```

Каталог товаров
```
export interface IProductList {
    getProducts(): IProduct[]; 
    setProducts(value: IProduct[]): void;
}
```

Корзина
```
export interface IBasket {
    getBasketList(): IProduct[];
    addToBasket(item: IProduct): void;
    removeFromBasket(id: string): void;
    getTotalAmount(): number;
    getTotalPrice(): number;
}
```

Информация о заказе
```
export interface IOrder extends IUserForm {
    total: number;
    items: string[];
}
``` 

Для результата успешного оформления заказа
```
export interface IOrderResult {
    id: string;
    total: number;
}
```

## Архитектура приложения

Код приложения разделен на слои, согласно пагадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных оотвечает за хранение и изменени данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый  сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие,
- `emit` - инициализация события.

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными о товарах.   
Конструктор класса принимает инстант брокер событий.
В полях класса хранятся следующие данные:
 - protected cards: IProduct[] массив объектов карточек с товарами

 Также в классе есть методы для взаимодействия с данными:
 - getProductById (productId: string): IProduct - возвращает карточку товара по ее id;
 - setProducts (value: IProduct[]):void - сохраняет массив товаров
 - getProducts ():IProduct[] - возвращает массив карточек


#### Класс BasketData
Класс отвечает за хранение и логику работы с данными о корзине товаров.
Конструктор класса принимает инстант брокер событий.
В полях класса хранятся следующие данные:
 - protected basketGoods: IProduct[] = [] - массив товаров, содержащихся в корзине

  Также в классе есть методы для взаимодействия с данными:   
 - addToBasket(item: IProduct): void - добавляет товар в корзину и вызывает событие  изменения массива с товарами в корзине 
 - removeFromBasket(id: string): void - убирает товар из корзины и вызывает событие  изменения массива с товарами в корзине
 - isBasketEmpty(): boolean - проверяет пустая ли корзина
 - isProductIn(productId: string): boolean - проверяет наличие товара в корзине
 - getTotalAmount(): number - возвращает количество товаров в корзине
 - getTotalPrice(): number - возвращает сумму всех товаров в корзине
 - getBasketList(): IProduct[] - возвращает массив товаров в корзине 
 - clearBasket(): void - очищает корзину
 - private emitChangeEvent(): void - метод для отправки события 

 #### Класс UserData
 Класс отвечает за хранение и логику работы с данными о пользователе и его заказе.
 Конструктор класса принимает инстант брокер событий.
 В полях класса хранятся следующие данные:
  - protected payment: string - способ оплаты товара
  - protected address: string - адрес доставки
  - protected email: string - имейл пользователя
  - protected phone: string - телефон пользователя

  Также в классе есть методы для взаимодействия с данными:   
  - getFieldData(): IUserForm - метод для получения данных вводимых пользователем
  - setFieldData <T extends keyof IUserForm>(field: T, value: IUserForm[T]): void - метод для сохранения данных вводимых пользователем
  - clearFrom():void - метод для очистки полей формы
  - checkValidation(): FormErrors; - проверяет объект с данными пользователя на валидность
  - getError(field: keyof IUserForm): string | undefined - получает сообщение об ошибке для конкретного поля формы
  - getAllErrors(): typeof this.errors - получает все текущие ошибки формы в виде объекта
  - private clearError(field: keyof IUserForm): void - очищает ошибки поля при его изменении 

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Класс, описывающий главную страницу, отображает список карточек и количество товаров в корзине.
При клике на карточку вызывается модальное окно с расширенной информацией о товаре, при клике на корзину, открывается модальное окно с ее содержимым.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 

Поля класса:
 - protected wrapper: HTMLElement - обертка страницы
 - protected basket: HTMLElement - элемент корзины
 - protected counter: HTMLElement - счетчик количества товаров в корзине
 - protected catalog: HTMLElement - коллекция карточек с товарами

 Методы:
 - setСounter(value: number): void - обновляет счетчик товаров в корзине
 - setCatalog(items: HTMLElement[]): void - отображает карточки товаров на странице
 - setLocked(value: boolean): void - блокирует страницу при открытии модального окна

 #### Класс Modal
Реализует модальное окно, также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлэй и кнопку крестик для закрытия поп-апа. 
Универсальное модальное окно, поддерживающее различные начинки, которые изменяются с помощью темплейтов.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 

Поля класса:
 - protected content: HTMLElement - элемент модального окна
 - protected closeButton: HTMLButtonElement - кнопка крестик

 Методы:
 - setContent(value: HTMLElement): void - устанавливает контент модального окна
 - open(): void - открытие модального окна
 - close(): void - закрытие модального окна
 - renderContent(): HTMLElement - генерирует разметку модального окна

 #### Класс Card
Отвечает за отображение карточки в модальном окне, задавая в ней данные названия, описания, изображение, катетогии товара и цены. В конструктор класса передается DOM-элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.
Поля класса содержат элементы разметки элементов карточки.  
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий.
Поля класса:
- protected title: HTMLElement - наименование товара 
- protected image?: HTMLImageElement - изображение товара
- protected category?: HTMLElement - категория товара
- protected price: HTMLElement - цена товара
- protected description?: HTMLElement - описание товара
- protected button?: HTMLButtonElement - кнопка удаления/добавления в корзину
- protected id: string - id карточки


Методы: 
- setTitle(value: string): void - заполняет заголовок карточки данными
- setDescription(value: string): void - заплдняет описание товара
- setCategory(value: ProductType): void - устанавливает категорию товара
- setPrice(value: number): void - заполняет цену товара
- setProductImage(value: string): void - устанавливает картинку товара в карточку
- getId(): string - получает id карточки
-  setId(value: string) - сохраняет id
-  toggleButton(inBasket: boolean): void - переключает текст кнопки (В корзину/Удалить из корзины)
- renderCard(): HTMLElement - возвращает полностью заполненную карточку с слушателями



#### Класс OrderForm
Отвечает за отображение формы со способом оплаты и адресом.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий.  
Поля класса: 
- protected address: HTMLInputElement - элемент поля ввода адреса
- protected offlinePayment: HTMLButtonElement - кнопка оплаты наличными
- protected onlinePayment: HTMLButtonElement - кнопка оплаты онлайн

Методы класса:
- render(): HTMLElement - генерирует разметку формы
- protected togglePaymentMethodButton(value: PaymentMethod): void - переключает метод оплаты

#### Класс ContactsForm
Отвечает за отображение формы с вводом телефона и имейла.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 
Поля класса:
- protected phone: string - поле ввода телефона
- protected email: string - поле ввода почты

Методы класса:
- render(state: Partial<IContactsForm> & IFormCommon) - генерирует разметку формы

#### Класс FormCommon
Отвечает за общие моменты при создании форм заказа.
Поля класса:
- protected submit: HTMLButtonElement - кнопка сабмита
- protected formErrors: HTMLElement - поле вывода ошибок формы

Методы класса:
- onInputChange(field: keyof T, value: string): void - генерация события для поля формы
- setValid(value: boolean) - метод управляет состоянием кнопки отправки формы (submit) на основе валидности формы
- setErrors(value: string) - отображает текст ошибок валидации в специальном блоке формы
- render(state: Partial<T> & IFormCommon) - метод выполняет динамическое обновление состояния формы на основе переданных данных


#### Класс Basket
Отвечает за отображение корзины и ее показывает товары, в ней содержащиеся.  
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 
Поля класса:
- protected list: HTMLElement - список товаров, добавленных в корзину
- protected totalPrice: HTMLElement - общая стоимость товаров в корзине
- protected orderButton: HTMLElement - кнопка оформления заказа

Методы:
- setTotalPrice(value: number): void - записывает стоимость товаров в корзине
- setList(value: HTMLElement[]): void - устанавливает разметку для списка карточек
- setIndex(items: HTMLElement[]) - устанавливает индекс каждому элементу корзины
- renderBasket(items:HTMLElement[], total: number) - генерируем разметку

#### Класс Success
Управляет отображением удачного заказа в модальном окне. Выводит сообщение об успешном оформлении заказа, а также стоимость покупки и кнопку За новыми покупками!
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 
Поля класса:
- protected furtherButton: HTMLButtonElement; - кнопка За новыми покупками!
- protected total: HTMLElement - общая стоимость покупок

Метод:
- setTotal(value: number): void - записывает итоговую стоимость покупок в заказе

### Слой коммуникации

#### Класс AppAPI
Принимает в конструктор экземпляр класса Арі и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимойствие представления и данных между собой находится в файле `index.ts`, выполняющем родь презентера.  
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.  
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*  
*События изменения данных(генерирутся классами моделями данных)*
 - `cards:changed` - изменение массива карточек
 - `basket:changed` - изменение массива товаров, лежащих в корзине


 *События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
 - `card:open` - открытие модального окна с карточкой товара
 - `basket:open` - открытие модального окна - корзины с товарами
 - `form:open` - открытие модального окна с необходимостью заполнить данные пользователя (при клике на кнопку Оформить)
 - `form:change` - изменение значений введенных в поле формы 
 - `basket-item:add` - добавление товара в корзину
 - `basket-item:delete` - удаление товара из корзины
 - `order:submit` - событие, генерируемое нажатием кнопки Далее, заполнение формы заказа
 - `contacts:submit` - событие, генерируемое нажатием кнопки Оплатить, окончание заполнения формы заказа
 - `/^order\..*: change/` - измение способа оплаты
 - `/^contacts\..*: change/` - изменения  полей формы контактов
 - `basket:delete` - удаление товара из списка в корзине
 - `modal:open` - модальное окно открыто
 - `modal:close` - модальное окно закрыто


