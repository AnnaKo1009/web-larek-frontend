# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Товар
```
export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

Форма с данными пользователя
```
export interface IUserForm {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```

Каталог товаров
```
export interface IProductList {
    cards: IProduct[];
}
```

Корзина
```
export interface IBasket {
    basketGoods: IProduct[];
}
```

Информация о заказе
```
export interface IOrder extends IUserForm {
    total: number;
    items: string[];
}
``` 

## Архитектура приложения

Код приложения разделен на слои, согласно пагадигме MVP:
- слой представления, отвечает за отображение данных на странице,
- слой данных оотвечает за хранение и изменени данных,
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый  сервера и опциональный объект с заголовками запросов.
Методы:
- `get` - выполняет GET запрос на переданный в параметрах эндпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на эндпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие,
- `emit` - инициализация события.

### Слой данных

#### Класс ProductData
Класс отвечает за хранение и логику работы с данными о товарах.   
Конструктор класса принимает инстант брокер событий.
В полях класса хранятся следующие данные:
 - protected cards: IProduct[] массив объектов карточек с товарами

 Также в классе есть метод для взаимодействия с данными:
 - getProductById (productId: string): IProduct - возвращает карточку товара по ее id;
 - setProducts (value: IProduct[]):void - сохраняет массив товаров
 - getProducts ():IProduct[] - возвращает массив карточек


#### Класс BasketData
Класс отвечает за хранение и логику работы с данными о корзине товаров.
Конструктор класса принимает инстант брокер событий.
В полях класса хранятся следующие данные:
 - protected basketGoods: IProduct[] = [] - массив товаров, содержащихся в корзине

  Также в классе есть методы для взаимодействия с данными:   
 - addToBasket(item: IProduct): void - добавляет товар в корзину и вызывает событие  изменения массива с товарами в корзине 
 - removeFromBasket(id: string): void - убирает товар из корзины и вызывает событие  изменения массива с товарами в корзине
 - getTotalAmount(): number - возвращает количество товаров в корзине
 - getTotalPrice(): number - возвращает сумму всех товаров в корзине
 - getBasketList(): IProduct[] - возвращает массив товаров в корзине 
 - clearBasket(): void - очищает корзину

 #### Класс UserData
 Класс отвечает за хранение и логику работы с данными о пользователе и его заказе.
 Конструктор класса принимает инстант брокер событий.
 В полях класса хранятся следующие данные:
  - protected payment: string - способ оплаты товара
  - protected address: string - адрес доставки
  - protected email: string - имейл пользователя
  - protected phone: string - телефон пользователя

  Также в классе есть методы для взаимодействия с данными:   
  - setFieldData <T extends keyof IUserForm>(field: T, value: IUserForm[T]): void - метод для сохранения данных вводимых пользователем
  - clearFrom():void - метод для очистки полей формы
  - checkValidation(): boolean; - проверяет объект с данными пользователя на валидность

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page
Класс, описывающий главную страницу, отображает список карточек и количество товаров в корзине.
При клике на карточку вызывается модальное окно с расширенной информацией о товаре, при клике на корзину, открывается модальное окно с ее содержимым.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 

Поля класса:
 - protected wrapper: HTMLElement - обертка страницы
 - protected basket: HTMLElement - элемент корзины
 - protected counter: HTMLElement - счетчик количества товаров в корзине
 - protected catalog: HTMLElement - коллекция карточек с товарами

 Методы:
 - setСounter(value: number): void - обновляет счетчик товаров в корзине
 - setCatalog(items: HTMLElement[]): void - отображает карточки товаров на странице
 - setLocked(value: boolean): void - блокирует страницу при открытии модального окна

 #### Класс Modal
Реализует модальное окно, также предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлэй и кнопку крестик для закрытия поп-апа. 
Универсальное модальное окно, поддерживающее различные начинки, которые изменяются с помощью темплейтов.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 

Поля класса:
 - protected content: HTMLElement - элемент модального окна
 - protected events: IEvents - брокер событий
 - protected closeButton: HTMLButtonElement - кнопка крестик

 Методы:
 - setContent(value: HTMLElement): void - устанавливает контент модального окна
 - open(): void - открытие модального окна
 - close(): void - закрытие модального окна
 - render(): HTMLElement - генерирует разметку модального окна

 #### Класс Card
Отвечает за отображение карточки в модальном окне, задавая в ней данные названия, описания, изображение, катетогии товара и цены. В конструктор класса передается DOM-элемент темплейта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события.
Поля класса содержат элементы разметки элементов карточки.  
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий.
Поля класса:
- protected title: HTMLElement - наименование товара 
- protected image?: HTMLImageElement - изображение товара
- protected category?: HTMLElement - категория товара
- protected price: HTMLElement - цена товара
- protected description?: HTMLElement - описание товара

Методы: 
- setData(cardData: IProduct): void - заполняет атрибуты элементов карточки данными
- render(): HTMLElement - возвращает полностью заполненную карточку с слушателями
Сеттер и Геттер сохраняет и  возвращает уникальный id карточки товара.


#### Класс OrderForm
Отвечает за отображение формы со способом оплаты и адресом.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий.  
Поля класса: 
- protected address: HTMLInputElement - элемент поля ввода адреса
- protected paymentMethodButton: HTMLButtonElement - элемент кнопок раздела способ оплаты
- protected submit: HTMLButtonElement - кнопка Далее
- protected errors: HTMLElement - текст ошибки

Методы класса:
- render(): HTMLElement - генерирует разметку формы
- disableButtons(): void - отключает активность кнопки далее пока не заполнены все поля формы
- setError(value: string): void - метод установки ошибки

#### Класс ContactsForm
Отвечает за отображение формы с вводом телефона и имейла.
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 
Поля класса:
- protected phone: HTMLInputElement - элемент поля ввода телефона
- protected email: HTMLInputElement - элемент поля ввода почты
- protected submit: HTMLButtonElement - кнопка Далее
- protected errors: HTMLElement - текст ошибки

Методы класса:
- render(): HTMLElement - генерирует разметку формы
- disableButtons(): void - отключает активность кнопки далее пока не заполнены все поля формы
- setError(value: string): void - метод установки ошибки


#### Класс Basket
Отвечает за отображение корзины и ее показывает товары, в ней содержащиеся.  
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 
Поля класса:
- protected list: HTMLElement - список товаров, добавленных в корзину
- protected totalPrice: HTMLElement - общая стоимость товаров в корзине
- protected orderButton: HTMLElement - кнопка оформления заказа

Методы:
- setTotalPrice(value: number): void - записывает стоимость товаров в корзине
- setList(value: HTMLElement[]): void - устанавливает разметку для списка карточек
- toggleButton(value: boolean): void - переключает кнопку (активность/неактивность)

#### Класс Success
Управляет отображением удачного заказа в модальном окне. Выводит сообщение об успешном оформлении заказа, а также стоимость покупки и кнопку За новыми покупками!
Конструктор кроме темплейта принимает экземпляр `EventEmitter` для инициализации событий. 
Поля класса:
- nextPurchaseButton: HTMLButtonElement - кнопка За новыми покупками!

Метод:
- setTotal(value: number): void - записывает итоговую стоимость покупок в заказе

### Слой коммуникации

#### Класс ShopAPI
Принимает в конструктор экземпляр класса Арі и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимойствие представления и данных между собой находится в файле `index.ts`, выполняющем родь презентера.  
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`.  
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*  
*События изменения данных(генерирутся классами моделями данных)*
 - `cards:changed` - изменение массива карточек
 - `basket:changed` - изменение массива товаров, лежащих в корзине

 *События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
 - `card:select` - выбор карточки товара для отображения в модальном окне
 - `card:open` - открытие модального окна с карточкой товара
 - `basket:open` - открытие модального окна - корзины с товарами
 - `form:open` - открытие модального окна с необходимостью заполнить данные пользователя
 - `success:open` - открытие модального окна успешной покупки
 - `item-add:submit` - сохранение товара в корзине
 - `item-remove:submit` - удаление товара из корзины
 - `basket:submit` - событие, генерируемое нажатием кнопки Оформить
 - `order:input` - ввод данных в форме с адресом пользователя
 - `contacts:input` - ввод данных в форме с телефоном и почтой(контактами)
 - `order:validation` - событие, сообщающее о необходимости валидации формы с адресом
 - `contacts:validation` - событие, сообщающее о необходимости валидации формы с контактами
 - `order:submit` - событие, генерируемое нажатием кнопки Далее
 - `contacts:submit` - событие, генерируемое нажатием кнопки Оплатить
 - `success:close` - событие, генерируемое нажатием кнопки За новыми покупками
